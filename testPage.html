<html lang="en">

	<head>
		
		<!-- we want to use D3, so this is where the D3 library version 5 gets called-->
		<script src="https://d3js.org/d3.v5.js"></script>
		<script src="https://d3js.org/d3-array.v2.min.js"></script>
		<!--title of the web-page-->
		<title> CS5044 Practical 3 - Tennis </title>

		<style>
			.tab {
				width: 100%;
				height: 50px;
				overflow: hidden;
				border: 1px solid #ccc;
				background-color: #f1f1f1;
			}
			.tab button{
				height: 100%;
				width: 25%;
				background-color: inherit;
				float: left;
				border: none;
				outline: none;
				cursor: pointer;
				padding: 14px 16px;
				transition: 0.3s;
			}
			.tab button:hover {
				background-color: #ddd;
			}
			.tab button.active {
				background-color: #ccc;
			}
			p{
				font-family: sans-serif;
				color: grey;
			}
			.vis-screen{
				width: 100%;
				height: 100%;
				display: none;
				grid-gap: 7px;
				grid-auto-columns: 50%;
				grid-auto-rows: 50%;
				position: relative;
			}
			.vis-panel{
				position: relative;
				background-color: #dddddd;
			}
			#myDiv {
				width: 100%;
				height: 100%;
			}
			svg{
				width: 100%;
				height: 100%;
			}
			rect{
				fill: gold;
				stroke: #999999;
				stroke-width: 2px;
			}
		</style>

	</head>

	<body>
	
		<!-- simple text heading-->
		<h2>Tennis Stats</h2>
		<div class="tab">
			<button class="tab-link" id="default-tab" onclick="openTab(event, 'overview')">Overview</button>
			<button class="tab-link" onclick="openTab(event, 'player-view')">Player view</button>
			<button class="tab-link" onclick="openTab(event, 'tournament-view')">Tournament view</button>
			<button class="tab-link" onclick="openTab(event, 'nationality-view')">Nationality view</button>
		</div>
		<div id="overview" class="vis-screen" style="margin-top: 3px; gap: 7px 7px; width:calc(100% - 7px); height: calc(100% - 100px);
		 grid-auto-columns: 50%; grid-auto-rows: 50%;">
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 1/ 2/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 1/ 3/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 2/ 2/ 3;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 2/ 3/ 3;">
			</div>
		</div>
		<div id="player-view" class="vis-screen" style="margin-top: 3px; gap: 7px 7px; width:calc(100% - 7px); height: calc(100% - 100px);
		 grid-auto-columns: 50%; grid-auto-rows: 50%;">
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 1/ 2/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 1/ 3/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 2/ 2/ 3;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 2/ 3/ 3;">
			</div>
		</div>
		<div id="tournament-view" class="vis-screen" style="margin-top: 3px; gap: 7px 7px; width:calc(100% - 7px); height: calc(100% - 100px);
		 grid-auto-columns: 50%; grid-auto-rows: 50%;">
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 1/ 2/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 1/ 3/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 2/ 2/ 3;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 2/ 3/ 3;">
			</div>
		</div>
		<div id="nationality-view" class="vis-screen" style="margin-top: 3px; gap: 7px 7px; width:calc(100% - 7px); height: calc(100% - 100px);
		 grid-auto-columns: 50%; grid-auto-rows: 50%;">
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 1/ 2/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 1/ 3/ 2;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 1/ 2/ 2/ 3;">
			</div>
			<div data-panelid="1" class="vis-panel" style="grid-area: 2/ 2/ 3/ 3;">
			</div>
		</div>

		<script>
			document.getElementById("default-tab").click();

			function openTab(evt, tabName) {
				// Declare all variables
				let i, tab_content, tab_links;

				// Get all elements with class="tab_content" and hide them
				tab_content = document.getElementsByClassName("vis-screen");
				for (i = 0; i < tab_content.length; i++) {
					tab_content[i].style.display = "none";
				}

				// Get all elements with class="tab-link" and remove the class "active"
				tab_links = document.getElementsByClassName("tab-link");
				for (i = 0; i < tab_links.length; i++) {
					tab_links[i].className = tab_links[i].className.replace(" active", "");
				}

				// Show the current tab, and add an "active" class to the button that opened the tab
				document.getElementById(tabName).style.display = "grid";
				evt.currentTarget.className += " active";
			}
		</script>

		<div id="myDiv">
			<svg>

			</svg>
		</div>

		<script>
			const dataPath = "data/three_years.csv";

			function winPercentBarChart(data) {
				let name_stats = [];
				let ids_done = {};
				let current_index = 0;

				// Filling name_dict
				data.forEach(function(d) {
					if (d["winner_id"] in ids_done) {
						let id = ids_done[d["winner_id"]];
						name_stats[id]["Wins"]++;
					}
					else {
						let new_player = {
							"ID":d["winner_id"],
							"Name":d["winner_name"],
							"Wins":1,
							"Losses":0
						};
						name_stats.push(new_player);
						ids_done[d["winner_id"]] = current_index;
						current_index++;
					}

					if (d["loser_id"] in ids_done) {
						let id = ids_done[d["loser_id"]];
						name_stats[id]["Losses"]++;
					}
					else {
						let new_player = {
							"ID":d["loser_id"],
							"Name":d["loser_name"],
							"Wins":0,
							"Losses":1
						};
						name_stats.push(new_player);
						ids_done[d["loser_id"]] = current_index;
						current_index++;
					}
				});


				console.log(name_stats);

				name_stats.forEach(function(d) {
					d["WinPercent"] = d["Wins"]/(d["Wins"]+d["Losses"]);
				});

				// Making bar chart
				d3.select("#myDiv")
						.select("svg")
						.selectAll("rect")
						.data(name_stats)
						.enter()
						.append("rect")
						.attr("width", function(d) {
							return d["WinPercent"] * 1000;
						})
						.attr("height", 20)
						.attr("x", 50)
						.attr("y", function(d, i) { // i in the index
							return i*50 + 50;
						})
						.on("mouseenter", function(d, i) {
							d3.select(this)
									.transition()
									.duration(200)
									.style("fill", "#FF9C00");
							d3.select("svg")
									.append("text")
									.attr("class", "tooltip")
									.attr("x", 50 + 10 + d["WinPercent"]*10)
									.attr("y", (i*50 + 50 + 15))
									.text(d["Name"] + ": " + d["WinPercent"] + "% win rate")
						})
						.on("mouseout", function() {
							d3.select(this)
									.transition()
									.duration(200)
									.style("fill", "gold");
							d3.selectAll(".tooltip")
									.remove();
						});

			}

			d3.csv(dataPath).then(function(data) {winPercentBarChart(data)});



		</script>
	
	</body>

</html>